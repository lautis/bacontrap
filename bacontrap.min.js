(function(){var t,e,n,r,a,o,i,u,l=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};u=function(e){var n;return n=e.which,t.map[n]||String.fromCharCode(n).toLowerCase()},e=function(t,e){return function(n){return t(e,n)}},t={input:{special:$(document).asEventStream("keydown").filter(function(e){var n;return n=t.map[e.which],n&&l.call(t.modifiers,n)<0}),keypress:$(document).asEventStream("keypress")},defaults:{timeout:1500,global:!1},aliases:{cmd:"meta",command:"meta",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl",option:"alt"},map:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},groups:{num:function(){var t,e;for(e=[],n=t=0;9>=t;n=++t)e.push(n.toString());return e}()},modifiers:["shift","alt","meta","ctrl"]},o=function(e,n){var r,a,o,u;for(u=t.modifiers,a=0,o=u.length;o>a;a++)if(r=u[a],i(r,n)!==l.call(e,r)>=0)return!1;return!0},i=function(t,e){var n,r,a;return a=e[t+"Key"]||u(e)===t,"keypress"===e.type&&"shift"===t?(r=u(e),n=r.toLowerCase()!==r.toUpperCase(),n&&a):a},r=function(e,n){return t.groups[e]?t.groups[e].indexOf(u(n))>=0:u(n)===e},a=function(e,n){var a,o,i;for(o=0,i=e.length;i>o;o++)if(a=e[o],l.call(t.modifiers,a)<0&&!r(a,n))return!1;return!0},t.match=function(t,e){return a(t,e)&&o(t,e)},t.notInput=function(t){var e,n;return e=t.target||t.srcElement||{},n=e.tagName,!("INPUT"===n||"SELECT"===n||"TEXTAREA"===n||e.isContentEditable)},t.trap=function(n,r,a,o){var i,u;return null==a&&(a=t.defaults.timeout),null==o&&(o=[]),i=r[o.length],u=0===o.length?n:n.take(1).takeUntil(Bacon.later(a,!0)),u.filter(e(t.match,i)).flatMap(function(e){return o.length+1===r.length?Bacon.once(e):t.trap(n,r,a,o.concat(e))})},t.parse=function(e){var n,r,a,o,i,u,l,s,c,f,p;for(r=function(e){var n;return(n=t.aliases[e])?[n]:1===e.length&&e.toLowerCase()!==e?["shift",e.toLowerCase()]:[e]},c=e.split(" "),p=[],i=0,l=c.length;l>i;i++){for(o=c[i],n=[],f=o.split("+"),u=0,s=f.length;s>u;u++)a=f[u],n.push.apply(n,r(a));p.push(n)}return p},t.bind=function(e,n){var r,a,o,i,u;return null==n&&(n={}),a=Bacon.mergeAll([t.input.keypress,t.input.special]),r=n.global||t.defaults.global?a:a.filter(t.notInput),u=function(){var a,u,l,s;for(l=[].concat(e),s=[],a=0,u=l.length;u>a;a++)i=l[a],o=t.parse(i),s.push(t.trap(r,o,n.timeout));return s}(),Bacon.mergeAll(u)},"undefined"!=typeof module&&null!==module?module.exports=t:this.window.Bacontrap=t}).call(this);