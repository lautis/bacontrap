/* Bacontrap v0.3.3. Copyright 2013 Ville Lautanala. https://raw.githubusercontent.com/lautis/bacontrap/master/LICENSE.txt */var Bacon,Bacontrap,curry2,i,matchKey,matchKeys,matchModifiers,modifierPressed,stringify,__indexOf=[].indexOf||function(t){for(var r=0,a=this.length;r<a;r++)if(r in this&&this[r]===t)return r;return-1};Bacon=require("baconjs"),stringify=function(t){var r;return r=t.which,Bacontrap.map[r]||String.fromCharCode(r).toLowerCase()},curry2=function(t,r){return function(a){return t(r,a)}},Bacontrap={input:{special:Bacon.fromEventTarget(document,"keydown").filter(function(t){var r;return r=Bacontrap.map[t.which],r&&__indexOf.call(Bacontrap.modifiers,r)<0}),keypress:Bacon.fromEventTarget(document,"keypress")},defaults:{timeout:1500,global:!1},aliases:{cmd:"meta",command:"meta",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl",option:"alt"},map:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},groups:{num:function(){var t,r;for(r=[],i=t=0;t<=9;i=++t)r.push(i.toString());return r}()},modifiers:["shift","alt","meta","ctrl"]},matchModifiers=function(t,r){var a,n,e,o;for(o=Bacontrap.modifiers,n=0,e=o.length;n<e;n++)if(a=o[n],modifierPressed(a,r)!==__indexOf.call(t,a)>=0)return!1;return!0},modifierPressed=function(t,r){var a,n,e;return e=r[t+"Key"]||stringify(r)===t,"keypress"===r.type&&"shift"===t?(n=stringify(r),a=n.toLowerCase()!==n.toUpperCase(),a&&e):e},matchKey=function(t,r){return Bacontrap.groups[t]?Bacontrap.groups[t].indexOf(stringify(r))>=0:stringify(r)===t},matchKeys=function(t,r){var a,n,e;for(n=0,e=t.length;n<e;n++)if(a=t[n],__indexOf.call(Bacontrap.modifiers,a)<0&&!matchKey(a,r))return!1;return!0},Bacontrap.match=function(t,r){return matchKeys(t,r)&&matchModifiers(t,r)},Bacontrap.notInput=function(t){var r,a;return r=t.target||t.srcElement||{},a=r.tagName,!("INPUT"===a||"SELECT"===a||"TEXTAREA"===a||r.isContentEditable)},Bacontrap.trap=function(t,r,a,n){var e,o;return null==a&&(a=Bacontrap.defaults.timeout),null==n&&(n=[]),e=r[n.length],o=0===n.length?t:t.take(1).takeUntil(Bacon.later(a,!0)),o.filter(curry2(Bacontrap.match,e)).flatMap(function(e){return n.length+1===r.length?Bacon.once(e):Bacontrap.trap(t,r,a,n.concat(e))})},Bacontrap.parse=function(t){var r,a,n,e,o,i,c,s,p,u,f;for(a=function(t){var r;return(r=Bacontrap.aliases[t])?[r]:1===t.length&&t.toLowerCase()!==t?["shift",t.toLowerCase()]:[t]},p=t.split(" "),f=[],o=0,c=p.length;o<c;o++){for(e=p[o],r=[],u=e.split("+"),i=0,s=u.length;i<s;i++)n=u[i],r.push.apply(r,a(n));f.push(r)}return f},Bacontrap.bind=function(t,r){var a,n,e,o,i;return null==r&&(r={}),n=Bacon.mergeAll([Bacontrap.input.keypress,Bacontrap.input.special]),a=r.global||Bacontrap.defaults.global?n:n.filter(Bacontrap.notInput),i=function(){var n,i,c,s;for(c=[].concat(t),s=[],n=0,i=c.length;n<i;n++)o=c[n],e=Bacontrap.parse(o),s.push(Bacontrap.trap(a,e,r.timeout));return s}(),Bacon.mergeAll(i)},module.exports=Bacontrap;