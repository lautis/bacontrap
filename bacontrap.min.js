(function(){var t,e,n,a,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};a=function(e){var n;return n=e.which,t.map[n]||String.fromCharCode(n).toLowerCase()},e=function(t,e){return function(n){return t(e,n)}},t={input:{special:$(document).asEventStream("keydown").filter(function(e){var n;return n=t.map[e.which],n&&r.call(t.modifiers,n)<0}),keypress:$(document).asEventStream("keypress")},defaults:{timeout:1500,global:!1},aliases:{cmd:"meta",command:"meta",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl",option:"alt"},map:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},groups:{num:function(){var t,e;for(e=[],n=t=0;9>=t;n=++t)e.push(n.toString());return e}()},modifiers:["shift","alt","meta","ctrl"]},t.match=function(e,n){var o,i,l,u;for(u=e.split("+"),i=0,l=u.length;l>i;i++)if(o=u[i],!(t.aliases[o]?t.match(t.aliases[o],n):t.groups[o]?t.groups[o].indexOf(a(n))>=0:r.call(t.modifiers,o)>=0?n[o+"Key"]||a(n)===o:a(n)===o))return!1;return!0},t.notInput=function(t){var e,n,a;return n=t.target||t.srcElement||{},e=n.contentEditable,a=n.tagName,!("INPUT"===a||"SELECT"===a||"TEXTAREA"===a||e&&"true"===e||"plaintext-only"===e)},t.trap=function(n,a,r,o){var i,l;return null==r&&(r=t.defaults.timeout),null==o&&(o=[]),i=a[o.length],l=0===o.length?n:n.take(1).takeUntil(Bacon.later(r,!0)),l.filter(e(t.match,i)).flatMap(function(e){return o.length+1===a.length?Bacon.once(e):t.trap(n,a,r,o.concat(e))})},t.parse=function(t){return t.toLowerCase().split(" ")},t.bind=function(e,n){var a,r,o,i,l;return null==n&&(n={}),r=Bacon.mergeAll([t.input.keypress,t.input.special]),a=n.global||t.defaults.global?r:r.filter(t.notInput),l=function(){var r,l,u,c;for(u=[].concat(e),c=[],r=0,l=u.length;l>r;r++)i=u[r],o=t.parse(i),c.push(t.trap(a,o,n.timeout));return c}(),Bacon.mergeAll(l)},"undefined"!=typeof module&&null!==module?module.exports=t:this.window.Bacontrap=t}).call(this);