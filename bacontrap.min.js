!function(){var a,b,c,d,e,f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};d=function(b){var c;return c=b.which,a.map[c]||String.fromCharCode(c).toLowerCase()},b=function(a,b){return function(c){return a(b,c)}},a={input:{special:$(document).asEventStream("keyup").filter(function(b){var c;return c=a.map[b.which],c&&f.call(a.modifiers,c)<0}),keypress:$(document).asEventStream("keypress")},defaults:{timeout:1500},aliases:{cmd:"meta",command:"meta",escape:"esc",mod:null!=(e=/Mac|iPod|iPhone|iPad/.test(navigator.platform))?e:{meta:"ctrl"},option:"alt"},map:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},groups:{num:function(){var a,b;for(b=[],c=a=0;9>=a;c=++a)b.push(c.toString());return b}()},modifiers:["shift","alt","meta","ctrl"]},a.match=function(b,c){var e,g,h,i;for(i=b.split("+"),g=0,h=i.length;h>g;g++)if(e=i[g],!(a.aliases[e]?a.match(a.aliases[e],c):a.groups[e]?a.groups[e].indexOf(d(c))>=0:f.call(a.modifiers,e)>=0?c[e+"Key"]||d(c)===e:d(c)===e))return!1;return!0},a.trap=function(c,d,e,f){var g,h;return null==e&&(e=a.defaults.timeout),null==f&&(f=[]),g=d[f.length],h=0===f.length?c:c.take(1).takeUntil(Bacon.later(e,!0)),h.filter(b(a.match,g)).flatMap(function(b){return f.length+1===d.length?Bacon.once(b):a.trap(c,d,e,f.concat(b))})},a.parse=function(a){return a.toLowerCase().split(" ")},a.bind=function(b,c){var d,e,f,g;return null==c&&(c={}),g=function(){var g,h,i,j;for(i=[].concat(b),j=[],g=0,h=i.length;h>g;g++)f=i[g],e=a.parse(f),d=Bacon.mergeAll([a.input.keypress,a.input.special]),j.push(a.trap(d,e,c.timeout));return j}(),Bacon.mergeAll(g)},"undefined"!=typeof module&&null!==module?module.exports=a:this.window.Bacontrap=a}.call(this);